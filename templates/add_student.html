{% extends "base.html" %}

{% block title %}Add Student - PM SHRI JNV GB NAGAR{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-person-plus"></i> Add New Student</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('students') }}">Students</a></li>
                        <li class="breadcrumb-item active">Add Student</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-person-badge"></i> Student Information</h5>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('add_manual_student') }}" method="post" id="addStudentForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="roll_number" class="form-label">Roll Number <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="roll_number" name="roll_number" required placeholder="e.g., JNV10A001">
                                <div class="form-text">Unique roll number for the student</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" required placeholder="e.g., Rahul Kumar">
                                <div class="form-text">Student's full name as per records</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="class_name" class="form-label">Class <span class="text-danger">*</span></label>
                                <select class="form-select" id="class_name" name="class_name" required>
                                    <option value="">Select Class</option>
                                    <option value="6">Class 6</option>
                                    <option value="7">Class 7</option>
                                    <option value="8">Class 8</option>
                                    <option value="9">Class 9</option>
                                    <option value="10">Class 10</option>
                                    <option value="11">Class 11</option>
                                    <option value="12">Class 12</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="section" class="form-label">Section <span class="text-danger">*</span></label>
                                <select class="form-select" id="section" name="section" required>
                                    <option value="">Select Section</option>
                                    <option value="A">Section A</option>
                                    <option value="B">Section B</option>
                                    <option value="C">Section C</option>
                                    <option value="D">Section D</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="gender" class="form-label">Gender <span class="text-danger">*</span></label>
                                <select class="form-select" id="gender" name="gender" required>
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle"></i> Guidelines</h6>
                            <ul class="mb-0 small">
                                <li>Roll number must be unique across all students</li>
                                <li>Use consistent naming format for better organization</li>
                                <li>Class and section information is used for seating arrangements</li>
                                <li>Gender information helps with anti-cheating algorithms</li>
                            </ul>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('students') }}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> Back to Students
                            </a>
                            <div>
                                <button type="button" class="btn btn-outline-primary me-2" onclick="previewStudent()">
                                    <i class="bi bi-eye"></i> Preview
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-person-plus"></i> Add Student
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-lightbulb"></i> Quick Tips</h6>
                </div>
                <div class="card-body">
                    <ul class="small mb-0">
                        <li><strong>Roll Number Format:</strong> Use consistent format like JNV[Class][Section][Number]</li>
                        <li><strong>Name Entry:</strong> Enter full name as it appears in official records</li>
                        <li><strong>Class Selection:</strong> Ensure correct class and section for proper seating</li>
                        <li><strong>Gender Info:</strong> Required for gender-based seating options</li>
                    </ul>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-collection"></i> Recent Students</h6>
                </div>
                <div class="card-body" id="recentStudents">
                    <div class="text-muted small">Loading recent additions...</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function previewStudent() {
    const form = document.getElementById('addStudentForm');
    const formData = new FormData(form);
    
    const preview = {
        roll_number: formData.get('roll_number'),
        name: formData.get('name'),
        class_name: formData.get('class_name'),
        section: formData.get('section'),
        gender: formData.get('gender')
    };
    
    if (!preview.roll_number || !preview.name || !preview.class_name || !preview.section || !preview.gender) {
        alert('Please fill all required fields to preview');
        return;
    }
    
    const previewText = `
Student Preview:
- Roll Number: ${preview.roll_number}
- Name: ${preview.name}
- Class: ${preview.class_name}${preview.section}
- Gender: ${preview.gender}
    `;
    
    alert(previewText);
}

// Load recent students
fetch('{{ url_for("get_student_data") }}')
    .then(response => response.json())
    .then(students => {
        const recentContainer = document.getElementById('recentStudents');
        if (students.length > 0) {
            const recent = students.slice(-5).reverse();
            recentContainer.innerHTML = recent.map(student => `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <strong>${student.name}</strong><br>
                        <small class="text-muted">${student.roll_number}</small>
                    </div>
                    <span class="badge bg-primary">${student.class || student['Class'] || 'N/A'}</span>
                </div>
            `).join('');
        } else {
            recentContainer.innerHTML = '<div class="text-muted small">No students added yet</div>';
        }
    })
    .catch(error => {
        document.getElementById('recentStudents').innerHTML = '<div class="text-muted small">Error loading data</div>';
    });
</script>
{% endblock %}